# V-JEPA 2 Policy Configuration - v5 Multi-Suite Training
# Key changes:
# - Training on combined libero_spatial + libero_object data
# - Standard architecture (no goal-conditioned queries)
# - More data diversity to improve generalization

# Model Architecture (Spatial tokens only - 64 tokens per modality)
model:
  embed_dim: 1408              # V-JEPA 2 ViT-Giant embedding dimension
  hidden_dim: 512              # Policy head hidden dimension
  num_layers: 4                # Transformer decoder layers
  num_heads: 8                 # Attention heads
  num_spatial_tokens: 64       # 8x8 spatial grid
  chunk_size: 50               # Action chunk size
  action_dim: 7                # 6 DoF + gripper
  proprio_dim: 15              # Proprioception dimensions
  proprio_history: 5           # Proprioception history length
  dropout: 0.1                 # Dropout rate
  use_goal_conditioned: false  # Standard architecture (v4's approach didn't help)

# V-JEPA 2 Encoder Configuration
encoder:
  model_path: "/workspace/models/vjepa2-ac-vitg.pt"
  model_name: "vjepa2_vitg"
  freeze: true
  num_frames: 16
  image_size: 256
  target_spatial: 8            # Spatial downsampling to 8x8

# Data Configuration - MULTI-SUITE
data:
  embeddings_dir: /workspace/data/embeddings
  libero_path: /workspace/data/libero
  # NEW: Train on multiple suites for more data diversity
  suites:
    - libero_spatial
    - libero_object
  train_split: 0.9
  # Embedding augmentation
  normalize: true              # L2 normalize embeddings
  noise_std: 0.05              # Gaussian noise during training
  # Gripper augmentation - conservative settings
  gripper_oversample: 2        # Oversample gripper transitions
  gripper_jitter: 0            # Disabled for stability
  # Static frame augmentation
  static_prob: 0.25            # Probability of fully static video
  beginning_prob: 0.25         # Probability of beginning-biased sampling
  max_beginning_frame: 30      # Max frame for beginning sampling

# Loss Configuration
loss:
  start_weight: 2.0            # Weight for initial timesteps
  start_steps: 10              # How many initial steps to upweight
  transition_weight: 3.0       # Weight for gripper transitions
  transition_window: 5         # Window around transitions
  balance_gripper: true        # Balance OPEN vs CLOSE samples
  gripper_loss_weight: 1.5     # Gripper loss weight
  gripper_dim: 6               # Index of gripper in action vector

# Training Configuration
training:
  epochs: 100
  batch_size: 32
  lr: 1.0e-4
  weight_decay: 1.0e-5
  warmup_epochs: 5
  grad_clip: 1.0
  use_amp: true                # Mixed precision training
  seed: 42
  num_workers: 4
  save_every: 10               # Save checkpoint every N epochs
  log_every: 10                # Log metrics every N steps

# Evaluation Configuration
evaluation:
  execute_steps: 10            # Actions before replanning
  max_episode_steps: 300       # Maximum episode length
  n_episodes_per_task: 20      # Episodes per task
  save_videos: false           # Save evaluation GIFs
  video_fps: 30
  suites:
    - libero_object
    - libero_spatial

# Logging Configuration
logging:
  wandb_project: "vjepa2-policy"
  log_every: 10
  checkpoint_dir: /workspace/checkpoints_v5
