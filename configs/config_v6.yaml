# V-JEPA 2 Policy Configuration - v6 Improved Spatial
# Key changes from v3:
# - Deeper model (6 layers vs 4)
# - Wider model (768 hidden dim vs 512)
# - More aggressive gripper training (oversample 4x, jitter 3)
# - Higher gripper loss weight (2.5 vs 1.5)
# - Longer training (200 epochs vs 100)
# - Spatial-only training (no multi-suite interference)

# Model Architecture - LARGER than V3
model:
  embed_dim: 1408              # V-JEPA 2 ViT-Giant embedding dimension
  hidden_dim: 768              # Increased from 512 (50% more capacity)
  num_layers: 6                # Increased from 4 (deeper reasoning)
  num_heads: 8                 # Keep 8 heads (768/8 = 96 dim per head)
  num_spatial_tokens: 64       # 8x8 spatial grid
  chunk_size: 50               # Action chunk size
  action_dim: 7                # 6 DoF + gripper
  proprio_dim: 15              # Proprioception dimensions
  proprio_history: 5           # Proprioception history length
  dropout: 0.1                 # Dropout rate

# V-JEPA 2 Encoder Configuration
encoder:
  model_path: "/workspace/models/vjepa2-ac-vitg.pt"
  model_name: "vjepa2_vitg"
  freeze: true
  num_frames: 16
  image_size: 256
  target_spatial: 8            # Spatial downsampling to 8x8

# Data Configuration - SPATIAL ONLY
data:
  embeddings_dir: /workspace/data/embeddings
  libero_path: /workspace/data/libero
  suite: libero_spatial        # Single suite (no multi-suite interference)
  train_split: 0.9
  # Embedding augmentation
  normalize: true              # L2 normalize embeddings
  noise_std: 0.05              # Gaussian noise during training
  # Gripper augmentation - MORE AGGRESSIVE
  gripper_oversample: 4        # Increased from 2 (2x more gripper samples)
  gripper_jitter: 3            # Added temporal jitter (was 0)
  # Static frame augmentation
  static_prob: 0.25            # Probability of fully static video
  beginning_prob: 0.25         # Probability of beginning-biased sampling
  max_beginning_frame: 30      # Max frame for beginning sampling

# Loss Configuration - GRIPPER FOCUSED
loss:
  start_weight: 2.0            # Weight for initial timesteps
  start_steps: 10              # How many initial steps to upweight
  transition_weight: 3.0       # Weight for gripper transitions
  transition_window: 5         # Window around transitions
  balance_gripper: true        # Balance OPEN vs CLOSE samples
  gripper_loss_weight: 2.5     # Increased from 1.5 (67% higher)
  gripper_dim: 6               # Index of gripper in action vector

# Training Configuration - LONGER
training:
  epochs: 200                  # Doubled from 100
  batch_size: 32
  lr: 1.0e-4
  weight_decay: 1.0e-5
  warmup_epochs: 10            # Increased from 5 (more warmup for larger model)
  grad_clip: 1.0
  use_amp: true                # Mixed precision training
  seed: 42
  num_workers: 4
  save_every: 20               # Save checkpoint every 20 epochs
  log_every: 10                # Log metrics every 10 steps

# Evaluation Configuration
evaluation:
  execute_steps: 10            # Actions before replanning
  max_episode_steps: 300       # Maximum episode length
  n_episodes_per_task: 20      # Episodes per task
  save_videos: false           # Save evaluation GIFs
  video_fps: 30
  suites:
    - libero_spatial

# Logging Configuration
logging:
  wandb_project: "vjepa2-policy"
  log_every: 10
  checkpoint_dir: /workspace/checkpoints_v6
